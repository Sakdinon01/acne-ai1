<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>AI Acne Classifier</title>
</head>

<body onload="init()">

  <h2>AI ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ß</h2>

  <input type="file" accept="image/*" onchange="predictImage(event)">
  <br><br>

  <img id="preview" width="300">
  <h3 id="result">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</h3>

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
  <!-- Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <script>
    // ‚ùó ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ URL
    const MODEL_URL = "./tm-my-image-model/";
    let model;

    // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•
    async function init() {
      try {
        model = await tmImage.load(
          MODEL_URL + "model.json",
          MODEL_URL + "metadata.json"
        );
        document.getElementById("result").innerText = "‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ";
        console.log("Model loaded");
      } catch (e) {
        console.error(e);
        document.getElementById("result").innerText = "‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå";
      }
    }

    // ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏£‡∏π‡∏õ
    async function predictImage(event) {
      if (!model) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏Å‡πà‡∏≠‡∏ô");
        return;
      }

      const file = event.target.files[0];
      const img = document.getElementById("preview");

      img.src = window.URL.createObjectURL(file);

      img.onload = async () => {
        const prediction = await model.predict(img);

        console.log(prediction); // üëà ‡∏î‡∏π‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Console

        prediction.sort((a, b) => b.probability - a.probability);
        const best = prediction[0];

        document.getElementById("result").innerHTML =
          `‡πÄ‡∏õ‡πá‡∏ô <b>${best.className}</b><br>
           ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ${(best.probability * 100).toFixed(2)}%`;
      };
    }
  </script>

</body>
</html>